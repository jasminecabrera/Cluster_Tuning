---
title: "simulation pt.2"
author: "Jasmine Cabrera"
format: html
editor: visual
---

## Simulating for 4 Clusters

```{r}
plotting_results <- function(result){
  # get all unique covariances
  vars <- sort(unique(result$covariance))
  
  # create a plot for each variance
  plots_list <- lapply(vars, function(var){
    result |>
      filter(covariance == var) |>
      ggplot(aes(x = factor(k), y = score)) +
      geom_boxplot(fill = "pink", color = "black") +
      labs(x = "k",
           y = "score",
           title = paste("Distribution of Score by k (variance =", var, ")")) +
      theme_minimal()
  })
  
  # name each element of the list for easy access
  names(plots_list) <- paste0("var_", vars)
  
  return(plots_list)}
```

### Test 1:

Testing different covariances: **1 run, samp. prop: 0.8, 100 obs, seed: 466**

```{r}
tictoc::tic()
simtest1 <- repeat_simulations(num_runs = 1,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.8, 
                            num_subsamples = 25,
                            start_seed = 466)
tictoc::toc()
```

```{r}

ggplot(simtest1, aes(x = k, y = score)) +
  geom_point() +
  facet_wrap(~ covariance) +
  geom_line() +
  theme_minimal()

data <- simulate_mvn(n = 100, 
                     covariance = 0.1, 
                     desired_k = 4, 
                     start_seed = 466)

data |>
  ggplot(aes(x = V1, y = V2)) +
  geom_point() +
  labs(title = "N = 100, Covariance = 0.1")
```

```{r}
readr::write_csv(simtest1, "simtest1.csv")
```

### Test 2:

Testing different covariances: **1 run, samp. prop: 0.8, 100 obs, seed: 599**

```{r}
tictoc::tic()
simtest2 <- repeat_simulations(num_runs = 1,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.8, 
                            num_subsamples = 25,
                            start_seed = 599)
tictoc::toc()
```

```{r}
ggplot(simtest2, aes(x = k, y = score)) +
  geom_point() +
  facet_wrap(~ covariance) +
  geom_line() +
  theme_minimal()
```

```{r}
readr::write_csv(simtest2, "simtest2.csv")
```

------------------------------------------------------------------------

\*\* increasing 100 obs to **250** **obs \*\***

### Test 3:

Testing different covariances: **1 run, samp. prop: 0.8, 250 obs, seed: 466**

```{r}
tictoc::tic()
simtest3 <- repeat_simulations(num_runs = 1,
                            n = 250,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.8, 
                            num_subsamples = 25,
                            start_seed = 466)
tictoc::toc()
```

```{r}
ggplot(simtest3, aes(x = k, y = score)) +
  geom_point() +
  facet_wrap(~ covariance) +
  geom_line() +
  theme_minimal()
```

```{r}
readr::write_csv(simtest3, "simtest3.csv")
```

### Test 4:

Testing different covariances: **1 run, samp. prop: 0.8, 250 obs, seed: 599**

```{r}
tictoc::tic()
simtest4 <- repeat_simulations(num_runs = 1,
                            n = 250,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.8, 
                            num_subsamples = 25,
                            start_seed = 599)
tictoc::toc()
```

```{r}
ggplot(simtest4, aes(x = k, y = score)) +
  geom_point() +
  facet_wrap(~ covariance) +
  geom_line() +
  theme_minimal()
```

```{r}
readr::write_csv(simtest4, "simtest4.csv")
```

------------------------------------------------------------------------

\*\* changing reps from 1 rep to **25 reps** \*\*

### Test 5:

Testing different covariances: **25 reps, samp. prop: 0.5, seed: 599**

```{r}
tictoc::tic()
simtest5 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.5, 
                            num_subsamples = 25,
                            start_seed = 599)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest5)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest5, "simtest5.csv")
```

### Test 6:

Testing different covariances: **25 reps, samp. prop: 0.5, seed: 123**

```{r}
tictoc::tic()
simtest6 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.5, 
                            num_subsamples = 25,
                            start_seed = 123)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest6)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest6, "simtest6.csv")
```

------------------------------------------------------------------------

\*\* increasing samp. prop from 0.5 to **0.6** \*\*

### Test 7:

Testing different covariances: **25 reps, samp. prop: 0.6, seed: 599**

```{r}
tictoc::tic()
simtest7 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.6, 
                            num_subsamples = 25,
                            start_seed = 599)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest7)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest7, "simtest7.csv")
```

### Test 8:

Testing different covariances: **25 reps, samp. prop: 0.6, seed: 123**

```{r}
tictoc::tic()
simtest8 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.6, 
                            num_subsamples = 25,
                            start_seed = 123)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest8)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest8, "simtest8.csv")
```

------------------------------------------------------------------------

\*\* increasing samp. prop from 0.6 to **0.7** \*\*

### Test 9:

Testing different covariances: **25 reps, samp. prop: 0.7, seed: 599**

```{r}
tictoc::tic()
simtest9 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.7, 
                            num_subsamples = 25,
                            start_seed = 599)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest9)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest9, "simtest9.csv")
```

### Test 10:

Testing different covariances: **25 reps, samp. prop: 0.7, seed: 123**

```{r}
tictoc::tic()
simtest10 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.7, 
                            num_subsamples = 25,
                            start_seed = 123)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest10)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest10, "simtest10.csv")
```

------------------------------------------------------------------------

\*\* increasing samp. prop from 0.7 to **0.8** \*\*

### Test 11:

Testing different covariances: **25 reps, samp. prop: 0.8, seed: 599**

```{r}
tictoc::tic()
simtest11 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.8, 
                            num_subsamples = 25,
                            start_seed = 599)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest11)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest11, "simtest11.csv")
```

### Test 12:

Testing different covariances: **25 reps, samp. prop: 0.8, seed: 123**

```{r}
tictoc::tic()
simtest12 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.8, 
                            num_subsamples = 25,
                            start_seed = 123)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest12)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest12, "simtest12.csv")
```

------------------------------------------------------------------------

\*\* increasing samp. prop from 0.8 to **0.9** \*\*

### Test 13:

Testing different covariances: **25 reps, samp. prop: 0.9, seed: 599**

```{r}
tictoc::tic()
simtest13 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.9, 
                            num_subsamples = 25,
                            start_seed = 599)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest13)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest13, "simtest13.csv")
```

### Test 14:

Testing different covariances: **25 reps, samp. prop: 0.9, seed: 123**

```{r}
tictoc::tic()
simtest14 <- repeat_simulations(num_runs = 25,
                            n = 100,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.9, 
                            num_subsamples = 25,
                            start_seed = 123)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest14)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest14, "simtest14.csv")
```

------------------------------------------------------------------------

\*\* increasing obs from 100 to **250 obs**, decreasing samp. prop to **0.6,** and decreasing reps to **25** \*\*

### Test 15:

Testing different covariances: **25 reps, samp. prop: 0.9, seed: 123**

```{r}
tictoc::tic()
simtest15 <- repeat_simulations(num_runs = 25,
                            n = 250,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.6, 
                            num_subsamples = 25,
                            start_seed = 599)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest15)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest15, "simtest15.csv")
```

### Test 16:

Testing different covariances: **50 reps, samp. prop: 0.9, seed: 123**

```{r}
tictoc::tic()
simtest16 <- repeat_simulations(num_runs = 25,
                            n = 250,
                            covariances = c(0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8), 
                            desired_k = 4, 
                            min_k = 2,
                            max_k = 10,
                            subsample_prop = 0.6, 
                            num_subsamples = 25,
                            start_seed = 123)
tictoc::toc()
```

```{r}
plot <- plotting_results(simtest16)
plot$var_0.05
plot$var_0.1
plot$var_0.2
plot$var_0.3
plot$var_0.4
plot$var_0.5
plot$var_0.6
plot$var_0.7
plot$var_0.8
```

```{r}
readr::write_csv(simtest16, "simtest16.csv")
```

------------------------------------------------------------------------

```{r}
# using own data
data <- simulate_mvn(n = 100, 
                     covariance = 0.01, 
                     desired_k = 4, 
                     start_seed = 123)

data |>
  ggplot(aes(x = V1, y = V2)) +
  geom_point()

# subsamples = 25
simulation_scores(data = data,
                  n = 100,
                  covariance = 0.01,
                  desired_k = 4, 
                  min_k = 2,
                  max_k = 8,
                  subsample_prop = 0.9, 
                  num_subsamples = 25,
                  start_seed = 123)

# subsamples = 35
simulation_scores(data = data,
                  n = 100,
                  covariance = 0.01,
                  desired_k = 4, 
                  min_k = 2,
                  max_k = 8,
                  subsample_prop = 0.9, 
                  num_subsamples = 35,
                  start_seed = 123)

# variance = 0.85
simulation_scores(data = data,
                  n = 100,
                  covariance = 0.01,
                  desired_k = 4, 
                  min_k = 2,
                  max_k = 8,
                  subsample_prop = 0.85, 
                  num_subsamples = 25,
                  start_seed = 123)

# variance = 0.8
simulation_scores(data = data,
                  n = 100,
                  covariance = 0.01,
                  desired_k = 4, 
                  min_k = 2,
                  max_k = 8,
                  subsample_prop = 0.8, 
                  num_subsamples = 25,
                  start_seed = 123)

# variance = 0.7
simulation_scores(data = data,
                  n = 100,
                  covariance = 0.01,
                  desired_k = 4, 
                  min_k = 2,
                  max_k = 8,
                  subsample_prop = 0.7, 
                  num_subsamples = 25,
                  start_seed = 123)
```

```{r}
data <- penguins |>
  dplyr::select(bill_length_mm, flipper_length_mm) |>
  drop_na() |>
  scale() |>
  as.data.frame()

penguins_output <- simulation_scores(data = data,
               min_k = 2,
               max_k = 5,
               subsample_prop = 0.8,
               num_subsamples = 100,
               start_seed = 123)

penguins_output

data <- penguins |>
  dplyr::select(bill_length_mm, flipper_length_mm, species) |>
  drop_na() |>
  as.data.frame()

data |>
  ggplot(aes(x = bill_length_mm, y = flipper_length_mm)) +
  geom_point() +
  labs(x = "Bill Length (mm)",
       y = "Flipper Length (mm)")
```

```{r}
penguins_output <- simulation_scores(data = data,
               min_k = 2,
               max_k = 5,
               subsample_prop = 0.4,
               num_subsamples = 100,
               start_seed = 123)

penguins_output
```

```{r}
data <- iris |>
  dplyr::select(Petal.Length, Petal.Width) |>
  drop_na() |>
  scale() |>
  as.data.frame()

iris_output <- simulation_scores(data = data,
               min_k = 2,
               max_k = 5,
               subsample_prop = 0.8,
               num_subsamples = 100,
               start_seed = 123)

iris_output

data <- iris |>
  dplyr::select(Petal.Length, Petal.Width, Species) |>
  drop_na() |>
  mutate(across(c(Petal.Length, Petal.Width), scale)) |>
  as.data.frame()

data |>
  ggplot(aes(x = Petal.Length, y = Petal.Width)) +
  geom_point() +
  labs(x = "Petal Length (cm)",
       y = "Petal Width (cm)")
```
