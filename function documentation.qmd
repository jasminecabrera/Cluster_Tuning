---
title: "function documentation"
format: html
editor: visual
---

# **Functions:**

------------------------------------------------------------------------

### **simulate_mvn()**

**Purpose:** Generates a simulated dataset from a multivariate normal (MVN) distribution

**Parameters:**

-   n *(integer)*: number of observations to generate

    -   **Note:** If n does not split evenly by desired_k, it will be rounded up

    -   *Default*: 100

-   covariance *(numeric)*: covariance value used to construct the dataset

    -   *Default*: 0.7

-   desired_k *(integer)*: desired number of clusters (k)

    -   *Default*: 3

-   start_seed *(integer)*: random seed for reproducibility

    -   *Default*: 123

**Output:** Returns an *n* x 2 standardized list with columns V1 and V2. Standardization is performed within the function.

**Example Code:**

```{r}
#| label: simulate_mvn - example

# example simulation
data <- simulate_mvn(n = 150, covariance = 0.3, desired_k = 3, start_seed = 123)

# plotting data
data |>
  ggplot(aes(x = V1,
             y = V2)) +
  geom_point()
```

------------------------------------------------------------------------

### **buddies_matrix()**

**Purpose:** Generates *buddies* matrix for each resample corresponding to a specified *k*. The number of matrices produces is equivalent to the number of subsamples. In these matrices, rivals are assigned a value of -1 and buddies are assigned a value of 1. Rivals belong to different clusters, while buddies belong to the same cluster. The function applies the k-means algorithm via the k_means() function.

**Parameters:**

-   data *(list)*: the dataset to be analyzed

-   k *(integer)*: the specific number of clusters (k) to evaluate

    -   *Default*: 3

-   subsample_prop *(numeric)*: proportion of the dataset to use for each resample

    -   *Default*: 0.8

-   num_subsamples *(integer)*: number of resamples to generate

    -   *Default*: 10

-   start_seed *(integer)*: random seed for reproducibility

    -   *Default*: 123

**Output:** Produces a list of matrices, where the number of matrices corresponds to *num_subsamples*.

**Example Code:**

```{r}

data <- simulate_mvn(n = 100, 
                     covariance = 0.3, 
                     desired_k = 3, 
                     start_seed = 123)

data |>
  ggplot(aes(x = V1,
             y = V2)) +
  geom_point()

buddy <- buddies_matrix(data = data,
                        k = 3,
                        subsample_prop = 0.8, 
                        num_subsamples = 2,
                        start_seed = 123)
```

------------------------------------------------------------------------

### **mean_matrix()**

**Purpose:** Computes a consistency score matrix for a specified *k* by measuring how frequently each pair of observations is clustered together across subsamples. Each element in the score matrix represents the sum of corresponding -1 and 1 values across subsamples, divided by the total number of valid comparisons. This approach excludes zeros, which indicate observations not included in a given resample. The function calls buddies_matrix() to obtain the matrices for this calculation.

**Parameters:**

-   data *(list)*: the dataset to be analyzed

-   k *(integer)*: the specific number of clusters (k) to evaluate

    -   *Default*: 3

-   subsample_prop *(numeric)*: proportion of the dataset to use for each resample

    -   *Default*: 0.8

-   num_subsamples *(integer)*: number of resamples to generate

    -   *Default*: 10

-   start_seed *(integer)*: random seed for reproducibility

    -   *Default*: 123

**Output:** Produces a list of two elements. The first element, results, stores the matrices generated by buddies_matrix(). The second element, score, represents the final mean consistency matrix calculated from those results.

**Example Code:**

```{r}
data <- simulate_mvn(n = 100, 
                     covariance = 0.3, 
                     desired_k = 3,
                     start_seed = 123)

mean_matrix_test <- mean_matrix(data = data, k = 3,
                               subsample_prop = 0.8, 
                               num_subsamples = 15,
                               start_seed = 123)
```

------------------------------------------------------------------------

### **similarity_score()**

**Purpose:** Computes a similarity score representing the squared distance from 1.

**Parameters:**

-   mean_matrix *(list)*: the output list produced by mean_matrix()

**Output:** Returns a single numeric value representing how closely the clustering results align with the desired number of *k* clusters, based on the consistency of the 1s and -1s in the score matrix.

**Example Code:**

```{r}
# simulate data
data <- simulate_mvn(n = 100, 
                     covariance = 0.3, 
                     desired_k = 3,
                     start_seed = 123)

# get score matrix
mean_matrix_test <- mean_matrix(data = data, k = 3,
                               subsample_prop = 0.8, 
                               num_subsamples = 15,
                               start_seed = 123)

# get similarity score
similarity_score(mean_matrix_test)
```

------------------------------------------------------------------------

### simulation_scores()

**Purpose:**

**Parameters:**

-   data *(list)*: the dataset to be analyzed

    -   **Note:** if not used, simulate_mvn() will be called

    -   *Default:* NULL

-   num_runs *(integer)*:

-   n *(integer)*: number of observations to generate

    -   **Note:** If n does not split evenly by desired_k, it will be rounded up

    -   *Default*: 100

-   covariance *(numeric)*: covariance value used to construct the dataset

    -   *Default*: 0.7

-   desired_k *(integer)*: the specific number of clusters *(k)* to evaluate

    -   *Default*: 3

-   min_k *(integer)*: the starting number of clusters *(k)* for evaluation

    -   *Default*: 2

-   max_k *(integer)*: the ending number of clusters *(k)* for evaluation

    -   *Default*: 5

-   subsample_prop *(numeric)*: proportion of the dataset to use for each resample

    -   *Default*: 0.8

-   num_subsamples *(integer)*: number of resamples to generate

    -   *Default*: 10

-   start_seed *(integer)*: random seed for reproducibility

    -   *Default*: 123

**Output:** A data frame where each row corresponds to a tested *k* cluster. The data frame includes the similarity score, runtime, and a *best_clust* column, which is blank for all rows except the one with the lowest similarity score, where it is marked as "BEST".

**Example Code:**

```{r}
# using own data
data <- simulate_mvn(n = 100, 
                     covariance = 0.2, 
                     desired_k = 3, 
                     start_seed = 123)

simulation_scores(data = data,
                  n = 100,
                  covariance = 0.2,
                  desired_k = 3, 
                  min_k = 2,
                  max_k = 5,
                  subsample_prop = 0.8, 
                  num_subsamples = 10,
                  start_seed = 123)

# creating data within f'n
simulation_scores(data = NULL,
                  n = 100,
                  covariance = 0.2,
                  desired_k = 3, 
                  min_k = 2,
                  max_k = 5,
                  subsample_prop = 0.8, 
                  num_subsamples = 10,
                  start_seed = 123)
```

------------------------------------------------------------------------

### repeat_simulations():

**Purpose:** Runs *simulation_scores()* repeatedly for a specified number of iterations, defined by *num_runs.*

**Parameters:**

-   data *(list)*: the dataset to be analyzed

    -   **Note:** if not used, simulate_mvn() will be called

    -   **Note:** only to be used if one covariance is listed

    -   *Default:* NULL

-   num_runs *(integer)*: number of iterations

-   n *(integer)*: number of observations to generate

    -   **Note:** If n does not split evenly by desired_k, it will be rounded up

    -   *Default*: 100

-   covariances *(list)*: list of covariance values used to construct the dataset

    -   *Default*: c(0.05, 0.1, 0.3)

-   desired_k *(integer)*: the specific number of clusters *(k)* to evaluate

    -   *Default*: 3

-   min_k *(integer)*: the starting number of clusters *(k)* for evaluation

    -   *Default*: 2

-   max_k *(integer)*: the ending number of clusters *(k)* for evaluation

    -   *Default*: 5

-   subsample_prop *(numeric)*: proportion of the dataset to use for each resample

    -   *Default*: 0.8

-   num_subsamples *(integer)*: number of resamples to generate

    -   *Default*: 10

-   start_seed *(integer)*: random seed for reproducibility

    -   *Default*: 123

**Output:** A data frame where each row corresponds to a tested combination of *k* cluster, covariance, and replication. The data frame includes the similarity score, runtime, covariance, replication, and *best_clust* column. This column is blank for all rows except the one with the lowest similarity score for that combination within its own replication, where it is marked as "BEST".

**Example Code:**

```{r}
# replicate simulations
test1 <- repeat_simulations(n = 100, 
                            num_runs = 15,
                            covariances = c(0.05, 0.1))

# distribution of scores (cov = 0.05)
test1 |>
  filter(covariance == 0.05) |>
  ggplot(aes(x = factor(k), 
             y = score)) +
  geom_boxplot(fill = "pink", 
               color = "black") +
  labs(x = "k",
       y = "score",
       title = "Distribution of Score by k (covariance = 0.05)") +
  theme_minimal()

# distribution of scores (cov = 0.1)
test1 |>
  filter(covariance == 0.1) |>
  ggplot(aes(x = factor(k), 
             y = score)) +
  geom_boxplot(fill = "pink", 
               color = "black") +
  labs(x = "k",
       y = "score",
       title = "Distribution of Score by k (covariance = 0.1)") +
  theme_minimal()
```
